---
import path from '../utils/path.ts';
// src/pages/index.astro
// Новая концепция: Галерея до/после на первом экране
import Layout from '../components/layout/Layout.astro';
import Button from '../components/ui/Button.astro';
import Card from '../components/ui/Card.astro';
import BeforeAfterSlider from '../components/ui/BeforeAfterSlider.astro';
import servicesData from '../content/services/services.json';
import galleryData from '../content/gallery/gallery.json';
import testimonialsData from '../content/testimonials/testimonials.json';

const locale = 'fr';
const services = servicesData.services.slice(0, 4);
const gallery = galleryData.items;
const testimonials = testimonialsData.testimonials;

// Placeholder изображения для разработки
const placeholderBefore = 'data:image/svg+xml,' + encodeURIComponent(`
<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600" viewBox="0 0 800 600">
  <rect fill="#9CA3AF" width="800" height="600"/>
  <text x="400" y="300" text-anchor="middle" fill="#4B5563" font-size="24" font-family="sans-serif">AVANT</text>
  <text x="400" y="340" text-anchor="middle" fill="#6B7280" font-size="16" font-family="sans-serif">Image placeholder</text>
</svg>
`);

const placeholderAfter = 'data:image/svg+xml,' + encodeURIComponent(`
<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600" viewBox="0 0 800 600">
  <rect fill="#8B4513" width="800" height="600"/>
  <text x="400" y="300" text-anchor="middle" fill="#D4A574" font-size="24" font-family="sans-serif">APRÈS</text>
  <text x="400" y="340" text-anchor="middle" fill="#A0522D" font-size="16" font-family="sans-serif">Résultat</text>
</svg>
`);

function renderStars(rating: number): string {
  return '★'.repeat(rating) + '☆'.repeat(5 - rating);
}
---
<Layout title="Réparation de Chaussures à Mulhouse" description="Artisan cordonnier à Mulhouse. Réparation de chaussures avec savoir-faire artisanal. Voir nos réalisations avant/après.">
  
  <!-- HERO: Галерея до/после на весь первый экран -->
  <section class="min-h-screen bg-gray-900 relative">
    <!-- Заголовок поверх галереи -->
    <div class="absolute top-0 left-0 right-0 z-20 bg-gradient-to-b from-black/70 to-transparent py-8 px-4">
      <div class="container mx-auto text-center">
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-4">
          Sapojnik
        </h1>
        <p class="text-xl md:text-2xl text-gray-200 max-w-2xl mx-auto">
          Cordonnier artisan à Mulhouse — Redonnez vie à vos chaussures
        </p>
      </div>
    </div>
    
    <!-- Главная галерея до/после -->
    <div class="h-screen flex items-center justify-center px-4 pt-24 pb-8">
      <div class="w-full max-w-5xl aspect-[4/3] md:aspect-[16/9]">
        <BeforeAfterSlider 
          beforeImage={placeholderBefore}
          afterImage={placeholderAfter}
          beforeLabel="Avant"
          afterLabel="Après"
          class="w-full h-full"
        />
      </div>
    </div>
    
    <!-- CTA внизу hero -->
    <div class="absolute bottom-0 left-0 right-0 z-20 bg-gradient-to-t from-black/70 to-transparent py-8 px-4">
      <div class="container mx-auto text-center">
        <p class="text-white text-lg mb-4">Glissez pour voir la transformation</p>
        <div class="flex gap-4 justify-center flex-wrap">
          <Button href="#gallery" variant="secondary">Voir plus de réalisations</Button>
          <Button href={path('/contact')} class="border-2 border-white text-white hover:bg-white hover:text-primary">
            Nous contacter
          </Button>
        </div>
      </div>
    </div>
  </section>

  <!-- Галерея работ -->
  <section id="gallery" class="py-20 bg-gray-50">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl md:text-4xl font-bold text-center mb-4 text-primary">Nos Réalisations</h2>
      <p class="text-gray-600 text-center mb-12 max-w-2xl mx-auto">
        Chaque paire mérite une seconde vie. Découvrez nos transformations.
      </p>
      
      <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
        {gallery.map((item, index) => (
          <div class="space-y-4">
            <BeforeAfterSlider 
              beforeImage={placeholderBefore}
              afterImage={placeholderAfter}
              beforeLabel="Avant"
              afterLabel="Après"
              class="aspect-[4/3]"
            />
            <div class="px-2">
              <h3 class="font-bold text-lg text-primary">{item.title[locale]}</h3>
              <p class="text-gray-600 text-sm">{item.description[locale]}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Услуги (кратко) -->
  <section class="py-20">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl md:text-4xl font-bold text-center mb-4 text-primary">Nos Services</h2>
      <p class="text-gray-600 text-center mb-12 max-w-2xl mx-auto">
        Réparation professionnelle avec des matériaux de qualité.
      </p>
      
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6 max-w-5xl mx-auto">
        {services.map((service) => (
          <Card class="text-center hover:shadow-xl transition-shadow">
            <h3 class="font-bold text-primary mb-2">{service.title[locale]}</h3>
            <p class="text-gray-600 text-sm mb-3">{service.description[locale]}</p>
            <span class="text-primary font-semibold text-sm">
              {service.prices.to ? `À partir de ${service.prices.from}` : service.prices.from}
            </span>
          </Card>
        ))}
      </div>
      
      <div class="text-center mt-10">
        <Button href={path('/services')} variant="outline">Tous les services</Button>
      </div>
    </div>
  </section>

  <!-- О мастере -->
  <section class="py-20 bg-primary text-white">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <div class="grid md:grid-cols-2 gap-12 items-center">
          <div>
            <h2 class="text-3xl md:text-4xl font-bold mb-6">À Propos</h2>
            <p class="text-white/90 mb-4 leading-relaxed">
              Passionné par le métier de cordonnier depuis plus de 15 ans, je mets mon savoir-faire 
              artisanal au service de vos chaussures.
            </p>
            <p class="text-white/90 mb-6 leading-relaxed">
              Mon atelier est situé au cœur de Mulhouse. Du simple talon à la restauration complète, 
              je m'engage à vous offrir le meilleur service avec des matériaux durables.
            </p>
            <Button href={path('/about')} class="bg-white text-primary hover:bg-secondary hover:text-white">
              En savoir plus
            </Button>
          </div>
          <div class="bg-white/10 rounded-2xl aspect-square flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 text-white/50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Отзывы -->
  <section class="py-20">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl md:text-4xl font-bold text-center mb-4 text-primary">Avis Clients</h2>
      <p class="text-gray-600 text-center mb-12 max-w-2xl mx-auto">
        La satisfaction de nos clients est notre priorité.
      </p>
      
      <div class="grid md:grid-cols-3 gap-6 max-w-5xl mx-auto">
        {testimonials.map((t) => (
          <Card class="bg-gray-50">
            <div class="text-yellow-500 text-lg mb-3">{renderStars(t.rating)}</div>
            <p class="text-gray-600 italic mb-4">"{t.text[locale]}"</p>
            <div class="border-t pt-4">
              <p class="font-semibold text-primary">{t.name}</p>
              <p class="text-gray-500 text-sm">{t.location}</p>
            </div>
          </Card>
        ))}
      </div>
    </div>
  </section>

  <!-- Финальный CTA -->
  <section class="py-20 bg-gray-900 text-white">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-3xl md:text-4xl font-bold mb-4">Besoin d'une réparation ?</h2>
      <p class="text-gray-300 mb-8 max-w-xl mx-auto">
        Apportez vos chaussures à l'atelier pour un devis gratuit.
      </p>
      <div class="flex gap-4 justify-center flex-wrap">
        <Button href={path('/contact')} variant="secondary">Nous contacter</Button>
        <Button href={path('/services')} class="border-2 border-white text-white hover:bg-white hover:text-gray-900">
          Voir les services
        </Button>
      </div>
    </div>
  </section>

</Layout>
